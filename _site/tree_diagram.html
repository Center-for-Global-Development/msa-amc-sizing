<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Decision Tree Flow Chart Example</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      margin: 0; 
      font-family: 'Georgia';
    }
    .wrapper {
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
    }
    #tree-container {
      width: 100%;
      margin: auto;
      height: 600px; 
    }
  </style>
</head>
<body>
<div class="wrapper">
  <div id="tree-container"></div>
</div>

<script>
  // We will manually position nodes and connect them with lines.
  // Then we label the lines with success/failure probabilities.

  // 1) Define an array of shapes to draw the connectors (arrows/lines).
  //    Each shape is a dictionary with (x0, y0) -> (x1, y1).
  const shapes = [
    // R&D node from Start:
    {
      type: 'line',
      x0: 0.1,  y0: 0.5,
      x1: 0.3,  y1: 0.5,
      line: {color: 'black', width: 2}
    },
    // Success from R&D to Patent
    {
      type: 'line',
      x0: 0.3,   y0: 0.5,
      x1: 0.5,   y1: 0.7,
      line: {color: 'green', width: 2}
    },
    // Failure from R&D to Abandon
    {
      type: 'line',
      x0: 0.3,   y0: 0.5,
      x1: 0.5,   y1: 0.3,
      line: {color: 'red', width: 2}
    },

    // Success from Patent to Test
    {
      type: 'line',
      x0: 0.5,   y0: 0.7,
      x1: 0.7,   y1: 0.7,
      line: {color: 'green', width: 2}
    },
    // Failure from Patent to Abandon
    {
      type: 'line',
      x0: 0.5,   y0: 0.7,
      x1: 0.7,   y1: 0.55,
      line: {color: 'red', width: 2}
    },

    // Success from Test to Approval
    {
      type: 'line',
      x0: 0.7,   y0: 0.7,
      x1: 0.9,   y1: 0.7,
      line: {color: 'green', width: 2}
    },
    // Failure from Test to Abandon
    {
      type: 'line',
      x0: 0.7,   y0: 0.7,
      x1: 0.9,   y1: 0.55,
      line: {color: 'red', width: 2}
    },

    // Success from Approval onward
    {
      type: 'line',
      x0: 0.9,   y0: 0.7,
      x1: 1.1,   y1: 0.7,
      line: {color: 'green', width: 2}
    },
    // Failure from Approval to Abandon
    {
      type: 'line',
      x0: 0.9,   y0: 0.7,
      x1: 1.1,   y1: 0.55,
      line: {color: 'red', width: 2}
    },
  ];

  // 2) Define annotations for each node and each branch.
  //    - Some are just node labels (R&D, Patent, etc.) with their cost/duration.
  //    - Some are arrow-labeled probabilities on success/failure branches.
  const annotations = [
    // Start
    {
      x: 0.1, y: 0.5,
      xanchor: 'center', yanchor: 'bottom',
      text: 'Start',
      showarrow: false, font: { size: 14 }
    },

    // R&D Node
    {
      x: 0.3, y: 0.5,
      xanchor: 'center', yanchor: 'bottom',
      text: 'R&D<br>3 yrs<br>Cost: 1,949k€',
      showarrow: false,
      font: { size: 12 }
    },
    // R&D success prob
    {
      x: 0.4, y: 0.6,
      text: '20%',
      showarrow: false,
      font: { size: 12, color: 'green' }
    },
    // R&D failure prob
    {
      x: 0.4, y: 0.4,
      text: '80%',
      showarrow: false,
      font: { size: 12, color: 'red' }
    },

    // Patent Node
    {
      x: 0.5, y: 0.7,
      xanchor: 'center', yanchor: 'bottom',
      text: 'Patent<br>1 yr<br>Cost: 137k€',
      showarrow: false,
      font: { size: 12 }
    },
    // Patent success prob
    {
      x: 0.6, y: 0.72,
      text: '75%',
      showarrow: false,
      font: { size: 12, color: 'green' }
    },
    // Patent failure prob
    {
      x: 0.6, y: 0.62,
      text: '25%',
      showarrow: false,
      font: { size: 12, color: 'red' }
    },

    // Test Node
    {
      x: 0.7, y: 0.7,
      xanchor: 'center', yanchor: 'bottom',
      text: 'Test<br>2 yrs<br>Cost: 208k€',
      showarrow: false,
      font: { size: 12 }
    },
    // Test success prob
    {
      x: 0.8, y: 0.72,
      text: '20%',
      showarrow: false,
      font: { size: 12, color: 'green' }
    },
    // Test failure prob
    {
      x: 0.8, y: 0.62,
      text: '80%',
      showarrow: false,
      font: { size: 12, color: 'red' }
    },

    // Approval Node
    {
      x: 0.9, y: 0.7,
      xanchor: 'center', yanchor: 'bottom',
      text: 'Approval<br>1 yr<br>Cost: 48k€',
      showarrow: false,
      font: { size: 12 }
    },
    // Approval success prob
    {
      x: 1.0, y: 0.72,
      text: '90%',
      showarrow: false,
      font: { size: 12, color: 'green' }
    },
    // Approval failure prob
    {
      x: 1.0, y: 0.62,
      text: '10%',
      showarrow: false,
      font: { size: 12, color: 'red' }
    },

    // Abandon “nodes” – we can just label them near the failure lines
    {
      x: 0.7, y: 0.3,
      text: 'Abandon',
      showarrow: false,
      font: { size: 12, color: 'red' }
    },
    {
      x: 0.9, y: 0.55,
      text: 'Abandon',
      showarrow: false,
      font: { size: 12, color: 'red' }
    },
    {
      x: 1.1, y: 0.55,
      text: 'Abandon',
      showarrow: false,
      font: { size: 12, color: 'red' }
    },

    // “Launch” or final success state
    {
      x: 1.1, y: 0.7,
      text: 'Launch / Commercialize',
      showarrow: false,
      font: { size: 12, color: 'green' }
    },
  ];

  // 3) We create a dummy Scatter trace so that Plotly will render
  //    an (x,y) coordinate system in which we can place shapes/annotations.
  const data = [{
    x: [0], 
    y: [0],
    mode: 'markers',
    marker: { opacity: 0 },
    showlegend: false
  }];

  // 4) Define layout with a fixed range so the chart stays in view.
  const layout = {
    title: {
      text: 'Drug/Vaccine Development Decision Tree',
      font: { family: 'Georgia', size: 20, color: 'black' }
    },
    xaxis: {
      range: [0, 1.2],
      showgrid: false,
      zeroline: false,
      showticklabels: false
    },
    yaxis: {
      range: [0, 1],
      showgrid: false,
      zeroline: false,
      showticklabels: false
    },
    shapes: shapes,
    annotations: annotations,
    margin: { t: 50, b: 0, l: 0, r: 0 },
    plot_bgcolor: '#ffffff'
  };

  // 5) Render
  Plotly.newPlot('tree-container', data, layout, {responsive: true});
</script>
</body>
</html>
